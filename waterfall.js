!function(){"use strict";!function(){let t=!1;function e(){this.sub={}}function i(t={}){e.call(this),this.opts={number:t.number,fixWidth:t.fixWidth||null,width:`${t.width||document.body.clientWidth||document.documentElement.clientWidth}px`,container:t.container||"waterfall",resize:!1},this.init(t),this.bind()}e.prototype.on=function(t,e){this.sub[t]||(this.sub[t]||(this.sub[t]=[]),this.sub[t].push(e))},e.prototype.emit=function(t){const e=Array.prototype.slice.call(arguments,1);for(let i=0,n=this.sub[t].length;i<n;i++)this.sub[t][i].apply(this,e)},i.prototype=Object.create(e.prototype),i.prototype.constructor=i;const n=i.prototype;n.compareOpts=function(t){const e=this;Object.keys(t).forEach(i=>{e.opts[i]=t[i]})},n.init=function(t){this.compareOpts(t);const e=document.getElementById(this.opts.container);e.style.width=`${this.opts.fixWidth||this.opts.width}px`;const i=e.getElementsByTagName("img");this.opts.resize&&this.resize(i);const n=this.getPerNum(),o=[];for(let t=0;t<n;t++)o.push(i[t].offsetHeight);let s=this.getMinPointer(o)||"0";if(this.opts.fixWidth)for(let t=0;t<n;t++)i[t].style.position="absolute",i[t].style.left=`${i[0].offsetLeft+i[t].offsetWidth*t}px`;for(let t=n;t<i.length;t++)i[t].style.position="absolute",i[t].style.left=`${i[s].offsetLeft}px`,i[t].style.top=`${o[s]}px`,o[s]=o[s]+i[t].offsetHeight,s=this.getMinPointer(o)},n.getPerNum=function(){const t=document.getElementById(this.opts.container).getElementsByTagName("img")[0].offsetWidth;return Math.floor(parseInt(this.opts.fixWidth||this.opts.width,10)/t)},n.append=function(){const t=document.getElementById(this.opts.container).getElementsByTagName("img"),e=t.length,i=this.getPerNum(),n=[],o=e-this.opts.number;let s=1;const l={},c=[];for(;s<100&&(l[t[o-s].offsetLeft]||0===l[t[o-s].offsetLeft]||(l[t[o-s].offsetLeft]=t[o-s].offsetLeft,n.push(t[o-s].offsetHeight+t[o-s].offsetTop),c.push(s),c.length!==i));)s++;let f=this.getMinPointer(n)||0;for(let e=0;e<this.opts.number;e++)t[o+e].style.position="absolute",t[o+e].style.left=`${t[o-c[Number(f)]].offsetLeft}px`,t[o+e].style.top=`${n[f]}px`,n[f]=n[f]+t[o+e].offsetHeight,f=this.getMinPointer(n)},n.bind=function(){this.opts.fixWidth||l.addEventListener("resize",o.bind(this)),l.addEventListener("scroll",s.bind(this))},n.getMinPointer=function(t){const e=Math.min.apply(null,t);for(let i in t)if(t[i]===e)return i},n.resize=function(t){for(let e=0;e<t.length;e++)t[e].style.position="static";this.opts.resize=!1},n.done=function(){const e=this;this.on("done",function(){t=!1,document.getElementsByClassName("waterfall-loading")[0].setAttribute("class",""),e.append()}),this.emit("done")},n.loadImg=function(){const t=document.getElementById(this.opts.container),e=document.createElement("div");e.setAttribute("class","waterfall-loading"),t.appendChild(e)};const o=function(){this.init({resize:!0,width:`${document.body.clientWidth||document.documentElement.clientWidth}px`})},s=function(){if(t)return!1;const e=document.getElementById(this.opts.container).getElementsByTagName("img");(document.body.scrollTop||document.documentElement.scrollTop)+(document.body.clientHeight||document.documentElement.clientHeight)>e[e.length-1].offsetTop&&(t=!0,this.loadImg(),this.emit("load"))},l={addEventListener:function(t,e){window.addEventListener(t,e,!1)}};window.Waterfall=i}()}();
