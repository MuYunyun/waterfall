!function(){"use strict";!function(){let t=!1;function e(){this.sub={}}function n(t={}){e.call(this),this.opts={number:t.number,width:`${t.width||document.body.clientWidth||document.documentElement.clientWidth}px`,container:t.container||"waterfall",resize:!1},t.width&&Object.assign(this.opts,{tmpWidth:t.width}),this.init(t),this.bind()}e.prototype.on=function(t,e){this.sub[t]||(this.sub[t]||(this.sub[t]=[]),this.sub[t].push(e))},e.prototype.emit=function(t){const e=Array.prototype.slice.call(arguments,1);for(let n=0,i=this.sub[t].length;n<i;n++)this.sub[t][n].apply(this,e)},n.prototype=Object.create(e.prototype),n.prototype.constructor=n;const i=n.prototype;i.compareOpts=function(t){const e=this;Object.keys(t).forEach(n=>{e.opts[n]=t[n]})},i.init=function(t){this.compareOpts(t);const e=document.getElementById(this.opts.container);e.style.width=this.opts.width;const n=e.getElementsByTagName("img");this.opts.resize&&this.resize(n);const i=this.getPerNum(),o=[];for(let t=0;t<i;t++)o.push(n[t].offsetHeight);let s=this.getMinPointer(o)||"0";for(let t=i;t<n.length;t++)n[t].style.position="absolute",n[t].style.left=`${n[s].offsetLeft}px`,n[t].style.top=`${o[s]}px`,o[s]=o[s]+n[t].offsetHeight,s=this.getMinPointer(o)},i.getPerNum=function(){const t=document.getElementById(this.opts.container).getElementsByTagName("img")[0].offsetWidth;return Math.floor(parseInt(this.opts.width,10)/t)},i.append=function(){const t=document.getElementById(this.opts.container).getElementsByTagName("img"),e=t.length,n=this.getPerNum(),i=[],o=e-this.opts.number;let s=1;const c={},l=[];for(;s<100&&(c[t[o-s].offsetLeft]||0===c[t[o-s].offsetLeft]||(c[t[o-s].offsetLeft]=t[o-s].offsetLeft,i.push(t[o-s].offsetHeight+t[o-s].offsetTop),l.push(s),l.length!==n));)s++;let h=this.getMinPointer(i)||0;for(let e=0;e<this.opts.number;e++)t[o+e].style.position="absolute",t[o+e].style.left=`${t[o-l[Number(h)]].offsetLeft}px`,t[o+e].style.top=`${i[h]}px`,i[h]=i[h]+t[o+e].offsetHeight,h=this.getMinPointer(i)},i.bind=function(){this.opts.tmpWidth||c.addEventListener("resize",o.bind(this)),c.addEventListener("scroll",s.bind(this))},i.getMinPointer=function(t){const e=Math.min.apply(null,t);for(let n in t)if(t[n]===e)return n},i.resize=function(t){for(let e=0;e<t.length;e++)t[e].style.position="static";this.opts.resize=!1},i.done=function(){const e=this;this.on("done",function(){t=!1,document.getElementsByClassName("waterfall-loading")[0].setAttribute("class",""),e.append()}),this.emit("done")},i.loadImg=function(){const t=document.getElementById(this.opts.container),e=document.createElement("div");e.setAttribute("class","waterfall-loading"),t.appendChild(e)};const o=function(){this.init({resize:!0,width:`${document.body.clientWidth||document.documentElement.clientWidth}px`})},s=function(){if(t)return!1;const e=document.getElementById(this.opts.container).getElementsByTagName("img");(document.body.scrollTop||document.documentElement.scrollTop)+(document.body.clientHeight||document.documentElement.clientHeight)>e[e.length-1].offsetTop&&(t=!0,this.loadImg(),this.emit("load"))},c={addEventListener:function(t,e){window.addEventListener(t,e,!1)}};window.Waterfall=n}()}();
